"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const world_config_1 = require("../../lib/lambdas/utils/world-config");
describe('World Config Utilities', () => {
    // Tests for parseWorldConfigsFromEnv function
    describe('parseWorldConfigsFromEnv', () => {
        const originalEnv = process.env;
        beforeEach(() => {
            // Reset environment variables before each test
            process.env = { ...originalEnv };
            delete process.env.WORLD_COUNT;
            delete process.env.WORLD_1_NAME;
            delete process.env.WORLD_1_WORLD_NAME;
            delete process.env.WORLD_1_PASSWORD;
            delete process.env.WORLD_1_DISCORD_ID;
            delete process.env.WORLD_2_NAME;
            delete process.env.WORLD_2_WORLD_NAME;
            delete process.env.WORLD_2_PASSWORD;
            delete process.env.WORLD_2_DISCORD_ID;
        });
        afterAll(() => {
            // Restore original environment
            process.env = originalEnv;
        });
        test('parses multiple world configs correctly from environment variables', () => {
            process.env.WORLD_COUNT = '2';
            process.env.WORLD_1_NAME = 'World1';
            process.env.WORLD_1_WORLD_NAME = 'ValheimWorld1';
            process.env.WORLD_1_PASSWORD = 'password1';
            process.env.WORLD_1_DISCORD_ID = '123456';
            process.env.WORLD_2_NAME = 'World2';
            process.env.WORLD_2_WORLD_NAME = 'ValheimWorld2';
            process.env.WORLD_2_PASSWORD = 'password2';
            process.env.WORLD_2_DISCORD_ID = '234567';
            const configs = (0, world_config_1.parseWorldConfigsFromEnv)();
            expect(configs).toHaveLength(2);
            expect(configs[0]).toEqual({
                name: 'World1',
                discordServerId: '123456',
                worldName: 'ValheimWorld1',
                serverPassword: 'password1'
            });
            expect(configs[1]).toEqual({
                name: 'World2',
                discordServerId: '234567',
                worldName: 'ValheimWorld2',
                serverPassword: 'password2'
            });
        });
        test('returns empty array when no WORLD_COUNT is set', () => {
            expect((0, world_config_1.parseWorldConfigsFromEnv)()).toEqual([]);
        });
        test('returns empty array when WORLD_COUNT is 0', () => {
            process.env.WORLD_COUNT = '0';
            expect((0, world_config_1.parseWorldConfigsFromEnv)()).toEqual([]);
        });
        test('should filter out incomplete configurations', () => {
            process.env.WORLD_COUNT = '2';
            process.env.WORLD_1_NAME = 'World1';
            process.env.WORLD_1_WORLD_NAME = 'ValidWorld';
            process.env.WORLD_1_PASSWORD = 'password123';
            // Missing WORLD_2_NAME for the second world
            process.env.WORLD_2_WORLD_NAME = 'IncompleteWorld';
            process.env.WORLD_2_PASSWORD = 'password456';
            const result = (0, world_config_1.parseWorldConfigsFromEnv)();
            // Should only have the complete configuration
            expect(result).toHaveLength(1);
            expect(result[0].name).toBe('World1');
        });
        test('should use default password when not provided', () => {
            process.env.WORLD_COUNT = '1';
            process.env.WORLD_1_NAME = 'TestWorld';
            process.env.WORLD_1_WORLD_NAME = 'TestValheimWorld';
            // No password set
            const result = (0, world_config_1.parseWorldConfigsFromEnv)();
            expect(result).toHaveLength(1);
            expect(result[0].serverPassword).toBe('valheim');
        });
        test('should handle missing Discord ID', () => {
            process.env.WORLD_COUNT = '1';
            process.env.WORLD_1_NAME = 'TestWorld';
            process.env.WORLD_1_WORLD_NAME = 'TestValheimWorld';
            process.env.WORLD_1_PASSWORD = 'testpass';
            // No Discord ID set
            const result = (0, world_config_1.parseWorldConfigsFromEnv)();
            expect(result).toHaveLength(1);
            expect(result[0].discordServerId).toBe('');
        });
    });
    // New tests for validateWorldConfig function
    describe('validateWorldConfig', () => {
        test('should return no errors for valid config', () => {
            const validConfig = {
                name: 'Test World',
                discordServerId: '12345678901234567',
                worldName: 'TestWorld',
                serverPassword: 'password123'
            };
            const errors = (0, world_config_1.validateWorldConfig)(validConfig);
            expect(errors).toHaveLength(0);
        });
        test('should validate name field', () => {
            // Empty name
            let config = {
                name: '',
                discordServerId: '123456789',
                worldName: 'TestWorld',
                serverPassword: 'password123'
            };
            let errors = (0, world_config_1.validateWorldConfig)(config);
            expect(errors.some(e => e.includes('name'))).toBeTruthy();
            // Too short
            config.name = 'AB';
            errors = (0, world_config_1.validateWorldConfig)(config);
            expect(errors.some(e => e.includes('name'))).toBeTruthy();
        });
        test('should validate worldName field', () => {
            // Empty world name
            let config = {
                name: 'Valid Name',
                discordServerId: '123456789',
                worldName: '',
                serverPassword: 'password123'
            };
            let errors = (0, world_config_1.validateWorldConfig)(config);
            expect(errors.some(e => e.includes('world name'))).toBeTruthy();
            // Invalid characters
            config.worldName = 'Invalid-Characters!';
            errors = (0, world_config_1.validateWorldConfig)(config);
            expect(errors.some(e => e.includes('letters, numbers, and underscores'))).toBeTruthy();
        });
        test('should validate serverPassword field', () => {
            // Empty password
            let config = {
                name: 'Valid Name',
                discordServerId: '123456789',
                worldName: 'ValidWorld',
                serverPassword: ''
            };
            let errors = (0, world_config_1.validateWorldConfig)(config);
            expect(errors.some(e => e.includes('password'))).toBeTruthy();
            // Too short
            config.serverPassword = 'pass';
            errors = (0, world_config_1.validateWorldConfig)(config);
            expect(errors.some(e => e.includes('password'))).toBeTruthy();
        });
        test('should validate discordServerId field', () => {
            // Invalid Discord ID (non-numeric)
            let config = {
                name: 'Valid Name',
                discordServerId: 'not-a-number',
                worldName: 'ValidWorld',
                serverPassword: 'password123'
            };
            let errors = (0, world_config_1.validateWorldConfig)(config);
            expect(errors.some(e => e.includes('Discord'))).toBeTruthy();
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid29ybGQtY29uZmlnLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ3b3JsZC1jb25maWcudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHVFQUFrSDtBQUVsSCxRQUFRLENBQUMsd0JBQXdCLEVBQUUsR0FBRyxFQUFFO0lBQ3RDLDhDQUE4QztJQUM5QyxRQUFRLENBQUMsMEJBQTBCLEVBQUUsR0FBRyxFQUFFO1FBQ3hDLE1BQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUM7UUFFaEMsVUFBVSxDQUFDLEdBQUcsRUFBRTtZQUNkLCtDQUErQztZQUMvQyxPQUFPLENBQUMsR0FBRyxHQUFHLEVBQUUsR0FBRyxXQUFXLEVBQUUsQ0FBQztZQUNqQyxPQUFPLE9BQU8sQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDO1lBQy9CLE9BQU8sT0FBTyxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUM7WUFDaEMsT0FBTyxPQUFPLENBQUMsR0FBRyxDQUFDLGtCQUFrQixDQUFDO1lBQ3RDLE9BQU8sT0FBTyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQztZQUNwQyxPQUFPLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0JBQWtCLENBQUM7WUFDdEMsT0FBTyxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQztZQUNoQyxPQUFPLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0JBQWtCLENBQUM7WUFDdEMsT0FBTyxPQUFPLENBQUMsR0FBRyxDQUFDLGdCQUFnQixDQUFDO1lBQ3BDLE9BQU8sT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQztRQUN4QyxDQUFDLENBQUMsQ0FBQztRQUVILFFBQVEsQ0FBQyxHQUFHLEVBQUU7WUFDWiwrQkFBK0I7WUFDL0IsT0FBTyxDQUFDLEdBQUcsR0FBRyxXQUFXLENBQUM7UUFDNUIsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsb0VBQW9FLEVBQUUsR0FBRyxFQUFFO1lBQzlFLE9BQU8sQ0FBQyxH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QUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDaEUsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsdUNBQXVDLEVBQUUsR0FBRyxFQUFFO1lBQ2pELG1DQUFtQztZQUNuQyxJQUFJLE1BQU0sR0FBZ0I7Z0JBQ3hCLElBQUksRUFBRSxZQUFZO2dCQUNsQixlQUFlLEVBQUUsY0FBYztnQkFDL0IsU0FBUyxFQUFFLFlBQVk7Z0JBQ3ZCLGNBQWMsRUFBRSxhQUFhO2FBQzlCLENBQUM7WUFFRixJQUFJLE1BQU0sR0FBRyxJQUFBLGtDQUFtQixFQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ3pDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDL0QsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcGFyc2VXb3JsZENvbmZpZ3NGcm9tRW52LCB2YWxpZGF0ZVdvcmxkQ29uZmlnLCBXb3JsZENvbmZpZyB9IGZyb20gJy4uLy4uL2xpYi9sYW1iZGFzL3V0aWxzL3dvcmxkLWNvbmZpZyc7XG5cbmRlc2NyaWJlKCdXb3JsZCBDb25maWcgVXRpbGl0aWVzJywgKCkgPT4ge1xuICAvLyBUZXN0cyBmb3IgcGFyc2VXb3JsZENvbmZpZ3NGcm9tRW52IGZ1bmN0aW9uXG4gIGRlc2NyaWJlKCdwYXJzZVdvcmxkQ29uZmlnc0Zyb21FbnYnLCAoKSA9PiB7XG4gICAgY29uc3Qgb3JpZ2luYWxFbnYgPSBwcm9jZXNzLmVudjtcbiAgICBcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIC8vIFJlc2V0IGVudmlyb25tZW50IHZhcmlhYmxlcyBiZWZvcmUgZWFjaCB0ZXN0XG4gICAgICBwcm9jZXNzLmVudiA9IHsgLi4ub3JpZ2luYWxFbnYgfTtcbiAgICAgIGRlbGV0ZSBwcm9jZXNzLmVudi5XT1JMRF9DT1VOVDtcbiAgICAgIGRlbGV0ZSBwcm9jZXNzLmVudi5XT1JMRF8xX05BTUU7XG4gICAgICBkZWxldGUgcHJvY2Vzcy5lbnYuV09STERfMV9XT1JMRF9OQU1FO1xuICAgICAgZGVsZXRlIHByb2Nlc3MuZW52LldPUkxEXzFfUEFTU1dPUkQ7XG4gICAgICBkZWxldGUgcHJvY2Vzcy5lbnYuV09STERfMV9ESVNDT1JEX0lEO1xuICAgICAgZGVsZXRlIHByb2Nlc3MuZW52LldPUkxEXzJfTkFNRTtcbiAgICAgIGRlbGV0ZSBwcm9jZXNzLmVudi5XT1JMRF8yX1dPUkxEX05BTUU7XG4gICAgICBkZWxldGUgcHJvY2Vzcy5lbnYuV09STERfMl9QQVNTV09SRDtcbiAgICAgIGRlbGV0ZSBwcm9jZXNzLmVudi5XT1JMRF8yX0RJU0NPUkRfSUQ7XG4gICAgfSk7XG4gICAgXG4gICAgYWZ0ZXJBbGwoKCkgPT4ge1xuICAgICAgLy8gUmVzdG9yZSBvcmlnaW5hbCBlbnZpcm9ubWVudFxuICAgICAgcHJvY2Vzcy5lbnYgPSBvcmlnaW5hbEVudjtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3BhcnNlcyBtdWx0aXBsZSB3b3JsZCBjb25maWdzIGNvcnJlY3RseSBmcm9tIGVudmlyb25tZW50IHZhcmlhYmxlcycsICgpID0+IHtcbiAgICAgIHByb2Nlc3MuZW52LldPUkxEX0NPVU5UID0gJzInO1xuICAgICAgcHJvY2Vzcy5lbnYuV09STERfMV9OQU1FID0gJ1dvcmxkMSc7XG4gICAgICBwcm9jZXNzLmVudi5XT1JMRF8xX1dPUkxEX05BTUUgPSAnVmFsaGVpbVdvcmxkMSc7XG4gICAgICBwcm9jZXNzLmVudi5XT1JMRF8xX1BBU1NXT1JEID0gJ3Bhc3N3b3JkMSc7XG4gICAgICBwcm9jZXNzLmVudi5XT1JMRF8xX0RJU0NPUkRfSUQgPSAnMTIzNDU2JztcbiAgICAgIHByb2Nlc3MuZW52LldPUkxEXzJfTkFNRSA9ICdXb3JsZDInO1xuICAgICAgcHJvY2Vzcy5lbnYuV09STERfMl9XT1JMRF9OQU1FID0gJ1ZhbGhlaW1Xb3JsZDInO1xuICAgICAgcHJvY2Vzcy5lbnYuV09STERfMl9QQVNTV09SRCA9ICdwYXNzd29yZDInO1xuICAgICAgcHJvY2Vzcy5lbnYuV09STERfMl9ESVNDT1JEX0lEID0gJzIzNDU2Nyc7XG4gICAgICBcbiAgICAgIGNvbnN0IGNvbmZpZ3MgPSBwYXJzZVdvcmxkQ29uZmlnc0Zyb21FbnYoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGNvbmZpZ3MpLnRvSGF2ZUxlbmd0aCgyKTtcbiAgICAgIGV4cGVjdChjb25maWdzWzBdKS50b0VxdWFsKHtcbiAgICAgICAgbmFtZTogJ1dvcmxkMScsXG4gICAgICAgIGRpc2NvcmRTZXJ2ZXJJZDogJzEyMzQ1NicsXG4gICAgICAgIHdvcmxkTmFtZTogJ1ZhbGhlaW1Xb3JsZDEnLFxuICAgICAgICBzZXJ2ZXJQYXNzd29yZDogJ3Bhc3N3b3JkMSdcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KGNvbmZpZ3NbMV0pLnRvRXF1YWwoe1xuICAgICAgICBuYW1lOiAnV29ybGQyJyxcbiAgICAgICAgZGlzY29yZFNlcnZlcklkOiAnMjM0NTY3JyxcbiAgICAgICAgd29ybGROYW1lOiAnVmFsaGVpbVdvcmxkMicsXG4gICAgICAgIHNlcnZlclBhc3N3b3JkOiAncGFzc3dvcmQyJ1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdyZXR1cm5zIGVtcHR5IGFycmF5IHdoZW4gbm8gV09STERfQ09VTlQgaXMgc2V0JywgKCkgPT4ge1xuICAgICAgZXhwZWN0KHBhcnNlV29ybGRDb25maWdzRnJvbUVudigpKS50b0VxdWFsKFtdKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3JldHVybnMgZW1wdHkgYXJyYXkgd2hlbiBXT1JMRF9DT1VOVCBpcyAwJywgKCkgPT4ge1xuICAgICAgcHJvY2Vzcy5lbnYuV09STERfQ09VTlQgPSAnMCc7XG4gICAgICBleHBlY3QocGFyc2VXb3JsZENvbmZpZ3NGcm9tRW52KCkpLnRvRXF1YWwoW10pO1xuICAgIH0pO1xuICAgIFxuICAgIHRlc3QoJ3Nob3VsZCBmaWx0ZXIgb3V0IGluY29tcGxldGUgY29uZmlndXJhdGlvbnMnLCAoKSA9PiB7XG4gICAgICBwcm9jZXNzLmVudi5XT1JMRF9DT1VOVCA9ICcyJztcbiAgICAgIHByb2Nlc3MuZW52LldPUkxEXzFfTkFNRSA9ICdXb3JsZDEnO1xuICAgICAgcHJvY2Vzcy5lbnYuV09STERfMV9XT1JMRF9OQU1FID0gJ1ZhbGlkV29ybGQnO1xuICAgICAgcHJvY2Vzcy5lbnYuV09STERfMV9QQVNTV09SRCA9ICdwYXNzd29yZDEyMyc7XG4gICAgICAvLyBNaXNzaW5nIFdPUkxEXzJfTkFNRSBmb3IgdGhlIHNlY29uZCB3b3JsZFxuICAgICAgcHJvY2Vzcy5lbnYuV09STERfMl9XT1JMRF9OQU1FID0gJ0luY29tcGxldGVXb3JsZCc7XG4gICAgICBwcm9jZXNzLmVudi5XT1JMRF8yX1BBU1NXT1JEID0gJ3Bhc3N3b3JkNDU2JztcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gcGFyc2VXb3JsZENvbmZpZ3NGcm9tRW52KCk7XG4gICAgICBcbiAgICAgIC8vIFNob3VsZCBvbmx5IGhhdmUgdGhlIGNvbXBsZXRlIGNvbmZpZ3VyYXRpb25cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgIGV4cGVjdChyZXN1bHRbMF0ubmFtZSkudG9CZSgnV29ybGQxJyk7XG4gICAgfSk7XG4gICAgXG4gICAgdGVzdCgnc2hvdWxkIHVzZSBkZWZhdWx0IHBhc3N3b3JkIHdoZW4gbm90IHByb3ZpZGVkJywgKCkgPT4ge1xuICAgICAgcHJvY2Vzcy5lbnYuV09STERfQ09VTlQgPSAnMSc7XG4gICAgICBwcm9jZXNzLmVudi5XT1JMRF8xX05BTUUgPSAnVGVzdFdvcmxkJztcbiAgICAgIHByb2Nlc3MuZW52LldPUkxEXzFfV09STERfTkFNRSA9ICdUZXN0VmFsaGVpbVdvcmxkJztcbiAgICAgIC8vIE5vIHBhc3N3b3JkIHNldFxuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBwYXJzZVdvcmxkQ29uZmlnc0Zyb21FbnYoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlTGVuZ3RoKDEpO1xuICAgICAgZXhwZWN0KHJlc3VsdFswXS5zZXJ2ZXJQYXNzd29yZCkudG9CZSgndmFsaGVpbScpO1xuICAgIH0pO1xuICAgIFxuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgbWlzc2luZyBEaXNjb3JkIElEJywgKCkgPT4ge1xuICAgICAgcHJvY2Vzcy5lbnYuV09STERfQ09VTlQgPSAnMSc7XG4gICAgICBwcm9jZXNzLmVudi5XT1JMRF8xX05BTUUgPSAnVGVzdFdvcmxkJztcbiAgICAgIHByb2Nlc3MuZW52LldPUkxEXzFfV09STERfTkFNRSA9ICdUZXN0VmFsaGVpbVdvcmxkJztcbiAgICAgIHByb2Nlc3MuZW52LldPUkxEXzFfUEFTU1dPUkQgPSAndGVzdHBhc3MnO1xuICAgICAgLy8gTm8gRGlzY29yZCBJRCBzZXRcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gcGFyc2VXb3JsZENvbmZpZ3NGcm9tRW52KCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgIGV4cGVjdChyZXN1bHRbMF0uZGlzY29yZFNlcnZlcklkKS50b0JlKCcnKTtcbiAgICB9KTtcbiAgfSk7XG4gIFxuICAvLyBOZXcgdGVzdHMgZm9yIHZhbGlkYXRlV29ybGRDb25maWcgZnVuY3Rpb25cbiAgZGVzY3JpYmUoJ3ZhbGlkYXRlV29ybGRDb25maWcnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIHJldHVybiBubyBlcnJvcnMgZm9yIHZhbGlkIGNvbmZpZycsICgpID0+IHtcbiAgICAgIGNvbnN0IHZhbGlkQ29uZmlnOiBXb3JsZENvbmZpZyA9IHtcbiAgICAgICAgbmFtZTogJ1Rlc3QgV29ybGQnLFxuICAgICAgICBkaXNjb3JkU2VydmVySWQ6ICcxMjM0NTY3ODkwMTIzNDU2NycsXG4gICAgICAgIHdvcmxkTmFtZTogJ1Rlc3RXb3JsZCcsXG4gICAgICAgIHNlcnZlclBhc3N3b3JkOiAncGFzc3dvcmQxMjMnXG4gICAgICB9O1xuICAgICAgXG4gICAgICBjb25zdCBlcnJvcnMgPSB2YWxpZGF0ZVdvcmxkQ29uZmlnKHZhbGlkQ29uZmlnKTtcbiAgICAgIGV4cGVjdChlcnJvcnMpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgICB9KTtcbiAgICBcbiAgICB0ZXN0KCdzaG91bGQgdmFsaWRhdGUgbmFtZSBmaWVsZCcsICgpID0+IHtcbiAgICAgIC8vIEVtcHR5IG5hbWVcbiAgICAgIGxldCBjb25maWc6IFdvcmxkQ29uZmlnID0ge1xuICAgICAgICBuYW1lOiAnJyxcbiAgICAgICAgZGlzY29yZFNlcnZlcklkOiAnMTIzNDU2Nzg5JyxcbiAgICAgICAgd29ybGROYW1lOiAnVGVzdFdvcmxkJyxcbiAgICAgICAgc2VydmVyUGFzc3dvcmQ6ICdwYXNzd29yZDEyMydcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGxldCBlcnJvcnMgPSB2YWxpZGF0ZVdvcmxkQ29uZmlnKGNvbmZpZyk7XG4gICAgICBleHBlY3QoZXJyb3JzLnNvbWUoZSA9PiBlLmluY2x1ZGVzKCduYW1lJykpKS50b0JlVHJ1dGh5KCk7XG4gICAgICBcbiAgICAgIC8vIFRvbyBzaG9ydFxuICAgICAgY29uZmlnLm5hbWUgPSAnQUInO1xuICAgICAgZXJyb3JzID0gdmFsaWRhdGVXb3JsZENvbmZpZyhjb25maWcpO1xuICAgICAgZXhwZWN0KGVycm9ycy5zb21lKGUgPT4gZS5pbmNsdWRlcygnbmFtZScpKSkudG9CZVRydXRoeSgpO1xuICAgIH0pO1xuICAgIFxuICAgIHRlc3QoJ3Nob3VsZCB2YWxpZGF0ZSB3b3JsZE5hbWUgZmllbGQnLCAoKSA9PiB7XG4gICAgICAvLyBFbXB0eSB3b3JsZCBuYW1lXG4gICAgICBsZXQgY29uZmlnOiBXb3JsZENvbmZpZyA9IHtcbiAgICAgICAgbmFtZTogJ1ZhbGlkIE5hbWUnLFxuICAgICAgICBkaXNjb3JkU2VydmVySWQ6ICcxMjM0NTY3ODknLFxuICAgICAgICB3b3JsZE5hbWU6ICcnLFxuICAgICAgICBzZXJ2ZXJQYXNzd29yZDogJ3Bhc3N3b3JkMTIzJ1xuICAgICAgfTtcbiAgICAgIFxuICAgICAgbGV0IGVycm9ycyA9IHZhbGlkYXRlV29ybGRDb25maWcoY29uZmlnKTtcbiAgICAgIGV4cGVjdChlcnJvcnMuc29tZShlID0+IGUuaW5jbHVkZXMoJ3dvcmxkIG5hbWUnKSkpLnRvQmVUcnV0aHkoKTtcbiAgICAgIFxuICAgICAgLy8gSW52YWxpZCBjaGFyYWN0ZXJzXG4gICAgICBjb25maWcud29ybGROYW1lID0gJ0ludmFsaWQtQ2hhcmFjdGVycyEnO1xuICAgICAgZXJyb3JzID0gdmFsaWRhdGVXb3JsZENvbmZpZyhjb25maWcpO1xuICAgICAgZXhwZWN0KGVycm9ycy5zb21lKGUgPT4gZS5pbmNsdWRlcygnbGV0dGVycywgbnVtYmVycywgYW5kIHVuZGVyc2NvcmVzJykpKS50b0JlVHJ1dGh5KCk7XG4gICAgfSk7XG4gICAgXG4gICAgdGVzdCgnc2hvdWxkIHZhbGlkYXRlIHNlcnZlclBhc3N3b3JkIGZpZWxkJywgKCkgPT4ge1xuICAgICAgLy8gRW1wdHkgcGFzc3dvcmRcbiAgICAgIGxldCBjb25maWc6IFdvcmxkQ29uZmlnID0ge1xuICAgICAgICBuYW1lOiAnVmFsaWQgTmFtZScsXG4gICAgICAgIGRpc2NvcmRTZXJ2ZXJJZDogJzEyMzQ1Njc4OScsXG4gICAgICAgIHdvcmxkTmFtZTogJ1ZhbGlkV29ybGQnLFxuICAgICAgICBzZXJ2ZXJQYXNzd29yZDogJydcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGxldCBlcnJvcnMgPSB2YWxpZGF0ZVdvcmxkQ29uZmlnKGNvbmZpZyk7XG4gICAgICBleHBlY3QoZXJyb3JzLnNvbWUoZSA9PiBlLmluY2x1ZGVzKCdwYXNzd29yZCcpKSkudG9CZVRydXRoeSgpO1xuICAgICAgXG4gICAgICAvLyBUb28gc2hvcnRcbiAgICAgIGNvbmZpZy5zZXJ2ZXJQYXNzd29yZCA9ICdwYXNzJztcbiAgICAgIGVycm9ycyA9IHZhbGlkYXRlV29ybGRDb25maWcoY29uZmlnKTtcbiAgICAgIGV4cGVjdChlcnJvcnMuc29tZShlID0+IGUuaW5jbHVkZXMoJ3Bhc3N3b3JkJykpKS50b0JlVHJ1dGh5KCk7XG4gICAgfSk7XG4gICAgXG4gICAgdGVzdCgnc2hvdWxkIHZhbGlkYXRlIGRpc2NvcmRTZXJ2ZXJJZCBmaWVsZCcsICgpID0+IHtcbiAgICAgIC8vIEludmFsaWQgRGlzY29yZCBJRCAobm9uLW51bWVyaWMpXG4gICAgICBsZXQgY29uZmlnOiBXb3JsZENvbmZpZyA9IHtcbiAgICAgICAgbmFtZTogJ1ZhbGlkIE5hbWUnLFxuICAgICAgICBkaXNjb3JkU2VydmVySWQ6ICdub3QtYS1udW1iZXInLFxuICAgICAgICB3b3JsZE5hbWU6ICdWYWxpZFdvcmxkJyxcbiAgICAgICAgc2VydmVyUGFzc3dvcmQ6ICdwYXNzd29yZDEyMydcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGxldCBlcnJvcnMgPSB2YWxpZGF0ZVdvcmxkQ29uZmlnKGNvbmZpZyk7XG4gICAgICBleHBlY3QoZXJyb3JzLnNvbWUoZSA9PiBlLmluY2x1ZGVzKCdEaXNjb3JkJykpKS50b0JlVHJ1dGh5KCk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il19